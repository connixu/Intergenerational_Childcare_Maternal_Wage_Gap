---
title: "Exploratory_Analysis"
author: "Connie Xu"
date: "Fall 2021"
output:
  html_document:
    df_print: paged
  pdf_document:
    keep_tex: yes
---

## Purpose
This r markdown file (also rendered as R and md files) includes exploratory analysis work completed for NLSY1979 and NLSY1997. This includes additional preprocessing and cleaning steps to make variables easier to understand, as well as initial descriptive statistics of distribution and data missingness. 

*Note that some results were adapted from work completed in Time Series Labs using the data that I downloaded, cleaned, and processed.* 

```{r load libraries, echo=FALSE, message=FALSE, warnings=FALSE}
library(plm)
library(dplyr)
library(plyr)
library(QMSS)
library(tidyverse)
library(stargazer)
library(psych)
library(ggplot2)
library(ggthemes) 
library(viridis)
library(hrbrthemes)
library(imputeTS)
library(kableExtra)
library(naniar)
library(plotly)
library(DT)
```

## NLSY97

### Summary of Columns 
Currently, my selected dataset is the **NLSY97**. The following are some relevant columns in the data set:  

```{r load data, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
# Load Data - Pre-cleaned 
load("~/QMSS/Intergenerational_Childcare_Maternal_Wage_Gap/data/NLSY_new_shortened.RData")

# Print Column Names
colnames(NLSY_new_shortened)
```

| Variable Name  | Variable Text | Values  |
| --- | --- | --- |
| PUBID_1997 | Unique Identifier  |  |
| KEY_SEX_1997 | Sex in 1997  | 1 = Male<br/>2 = Female |
| KEY_RACE_ETHNICITY_1997 | Race/Ethnicity 1997  |  |
| KEY_BDATE_M_1997 | Birthday Month | 1-12 |
| KEY_BDATE_Y_1997 | Birthday YEAR  |  |
| CV_SAMPLE_TYPE_1997 | Cross Section / Oversample | 1 = Cross Sectional<br/> 0 = Oversample |
| KEY_RACE_ETHNICITY_1997 | Race / Ethnicity  | 1 = Black<br/>2 = Hispanic<br/>3 =  Mixed Race<br/>4 = Non Black Non Hispanic  |
| YINC-1400  | Any Income Earned this YEAR? (Binary)  | 0 = No 1 = Yes |
| YINC-1700 | Income (Continuous) | 0-999999+ |
| P2-001 | Was Parent 1 Born in US  | 0 - 1  |
| CV_CITIZENSHIP | U.S. citizenship status based on place of birth. | 1 = Yes, 2= No, 3 = No Response |
| MAR_STATUS.01_XRND - MAR_STATUS.12_XRND | Marital Status Jan - Dec of Survey YEAR  | 0 = Never Married, Not Cohabitating <br/> 1 = Never Married, Cohabiting<br/> 2 = Married<br/> 3 = Legally Separated <br/> 4 = Divorced<br/> 5 = Widowed |
| CV_BIO_CHILD_HH | Number of Biological Children RESIDING in the Household (Note: Rs without any biological children are assigned a valid skip (-4).) | 0 - 10+ |
| CV_HH_UNDER_6 | Number of Childen in R’s household under 6  | 0 - 10+ |
| CV_BIO_CHILD_NR | Number of Biological Children NOT RESIDING in the Household (Note: Rs without any biological children are assigned a valid skip (-4).) | 0 - 10+ |
| CV_ENROLLSTAT / CV_ENROLLSTAT_EDT | Enrolled in School?  | 1  = Not enrolled, no high school degree, no GED<br/> 2  = Not enrolled, GED<br/> 3  = Not enrolled, high school degree<br/>4  = Not enrolled, some college<br/> 5  = Not enrolled, 2-YEAR college graduate<br/> 6  = Not enrolled, 4-YEAR college graduate<br/> 7  = Not enrolled, graduate degree<br/> 8  = Enrolled in grades 1-12, not a high school graduate<br/> 9  = Enrolled in a 2-YEAR college<br/> 10 = Enrolled in a 4-YEAR college<br/> 11 = Enrolled in a graduate program |
| CV_HGC_EVER_EDT | Highest ever enrollment  | 0 = None<br/> 1 = GED<br/> 2 = High school diploma (Regular 12 YEAR program)<br/> 3 = Associate/Junior college (AA)<br/> 4 = Bachelor's degree (BA, BS)<br/> 5 = Master's degree (MA, MS)<br/> 6 = PhD<br/> 7 = Professional degree (DDS, JD, MD) |
| YCCA-450/YCCAL-450 | AVERAGE HOURS PER WEEK R SPENDS AT WORK, SCHOOL, TRAINING IN PAST 12 MOS (CCA) | 0-999999+ |
| YCCA-6800 | ANY RELATIVES LIVE WITHIN 15 MINUTES OF CHILD'S HOME | 0 - 1  |
| YCCA-1100.01 - 05 | PRIMARY CHILD CARE ARRANGEMENT, CHILD 01-05 | 1 = Spousal or Partner Care<br/> 2 = Relative Care<br/> 3 = Sibling Care<br/> 4 = Self-Care<br/>5 = Non-relative Care<br/> 6 = Family Day Care<br/> 7 = Child Care Center<br/> 8 = Formal Schooling |
| YCCA-1000.01 - 05 | SECONDARY CHILD CARE ARRANGEMENT, CHILD 01-05 | 1 = Spousal or Partner Care<br/> 2 = Relative Care<br/>3 = Sibling Care<br/> 4 = Self-Care<br/> 5 = Non-relative Care<br/> 6 = Family Day Care<br/> 7 = Child Care Center
8 = Formal Schooling |
| YCCAL-1100A.0\*~00000& | \* → number of child <br/> \& → Question Number  |  |
| YCCA-6150.01-05 | Time Unit someone pays for childcare  | 1 = Per Hour<br/> 2 = Per Day<br/> 3 = Per Week |
| YCCAL-4500.0X.06 | WHO TOOK CHILD 0X TO AND FROM FAMILY DAY CARE |  |
| YHHI-55701 | WAS R BORN IN U.S., ITS TERRITORIES OR PUERTO RICO |  |
| YHHI-55704 | WHAT IS R'S CITIZENSHIP STATUS |  |
| YHHI-55705A | HOW OLD WAS R WHEN FIRST CAME TO U.S. FOR 6 MONTHS OR MORE |  |
| YCCAL-6900 | # OF RELATIVES LIVE WITHIN 15 MINUTES OF CHILD'S HOME | 0-10 |
| YCCAL-7100 | ANY RELATIVES W/IN 15 MIN ABLE TO CARE FOR CHILD REGULARLY WITH NO PAYMENT | 0-1 |
| YCCAL-4500.02.05 | WHO TOOK CHILD 0X TO AND FROM FAMILY DAY CARE  | 1 = Respondent<br/> 2 = Child's father<br/> 3 = Equal split between R and child's father<br/> 4 = Respondent's spouse, partner (who is NOT child's father)<br/> 5 = This relative<br/> 6 = Other (SPECIFY)<br/> 999 = UNCODABLE |
| YCCAL-7300 | ANY RELATIVES LIVE WITHIN 15-45 MINUTES OF CHILD'S HOME |  |
| YCCAL-7400 | # OF RELATIVES LIVE WITHIN 15-45 MINUTES OF CHILD'S HOME |  |
| YCCAL-9100 | # OF RELATIVES W/IN 15 MINS OF R'S HOME, R HAS NO CHILDREN |  |
| YCCAL-9000 | DOES R HAVE RELATIVE THAT LIVE W/IN 15 MINUTES, R HAS NO CHILDREN |  |
| YCCAL-9200 | R HAVE RELATIVE W/IN 15 MINS ABLE CARE FOR CHILD REGULARLY, R HAS NO KIDS | 0-1  |
| YCCAL-9300 | ANY RELATIVES THAT LIVE BETWEEN 15-45 MINUTES OF R'S HOME, R HAS NO KIDS | 0-1 |

Not all of these columns were ultimately used for this project. Of the existent columns, some of the following steps were completed to reformat the data further for use in regression models: 

- Per Steve McKlaskie from the NLS User Services, "in survey years 2005, 2008, 2011, and 2015 (rnds 9, 12, 15 and 17), the YCCAL questions were added and limited to females born in 1983 and 1984. The older females (born 1980, 1981, 1982) go through the YCCA questions. So, in these rounds your will need to look at both YCCA-1100A and YCCAL-1100A, which are limited to children under the age of 7." In order to address this, these will be treated as one variable (INTERGENERATION_CHILDCARE). Similarly, this was done for Spousal and Childcare Center variables. 
- I recoded several variables as binary where it is possible (e.g., Married and Cohabitating vs. not) 
- I also tried to create a variable combining YINC-1400 and YINC-1700, where I am imputing 0 where YINC-1700 is NA and YINC-1400 is 0 (i.e., situations where both variables are 0)
- For the current data, I am coding the childcare variables as the case where *any* of the respondent's children are recieving childcare and/or are under 6 years of age. 

```{r preprocess data, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
# Step 1. Filter for Women Only  
NLSY <- NLSY_new_shortened %>% subset(KEY_SEX_1997 == 2)

# Step 2. Reformat data - YCCAL-1100A~0000X to be the max value (across five children). 
NLSY$`YCCAL-1100A~000001` <- pmax(NLSY$`YCCAL-1100A.01~000001`,NLSY$`YCCAL-1100A.02~000001`,NLSY$`YCCAL-1100A.03~000001`,NLSY$`YCCAL-1100A.04~000001`,NLSY$`YCCAL-1100A.05~000002`,  na.rm = TRUE)
NLSY$`YCCAL-1100A~000002` <- pmax(NLSY$`YCCAL-1100A.01~000002`,NLSY$`YCCAL-1100A.02~000002`,NLSY$`YCCAL-1100A.03~000002`,NLSY$`YCCAL-1100A.04~000002`,NLSY$`YCCAL-1100A.05~000002`,  na.rm = TRUE)
NLSY$`YCCAL-1100A~000003` <- pmax(NLSY$`YCCAL-1100A.01~000003`,NLSY$`YCCAL-1100A.02~000003`,NLSY$`YCCAL-1100A.03~000003`,NLSY$`YCCAL-1100A.04~000003`,NLSY$`YCCAL-1100A.05~000003`,  na.rm = TRUE)
NLSY$`YCCAL-1100A~000004` <- pmax(NLSY$`YCCAL-1100A.01~000004`,NLSY$`YCCAL-1100A.02~000004`,NLSY$`YCCAL-1100A.03~000004`,NLSY$`YCCAL-1100A.04~000004`,NLSY$`YCCAL-1100A.05~000004`,  na.rm = TRUE)
NLSY$`YCCAL-1100A~000005` <- pmax(NLSY$`YCCAL-1100A.01~000005`,NLSY$`YCCAL-1100A.02~000005`,NLSY$`YCCAL-1100A.03~000005`,NLSY$`YCCAL-1100A.04~000005`,NLSY$`YCCAL-1100A.05~000005`,  na.rm = TRUE)
NLSY$`YCCAL-1100A~000006` <- pmax(NLSY$`YCCAL-1100A.01~000006`,NLSY$`YCCAL-1100A.02~000006`,NLSY$`YCCAL-1100A.03~000006`,NLSY$`YCCAL-1100A.04~000006`,NLSY$`YCCAL-1100A.05~000006`,  na.rm = TRUE)
NLSY$`YCCAL-1100A~000007` <- pmax(NLSY$`YCCAL-1100A.01~000007`,NLSY$`YCCAL-1100A.02~000007`,NLSY$`YCCAL-1100A.03~000007`,NLSY$`YCCAL-1100A.04~000007`,NLSY$`YCCAL-1100A.05~000007`,  na.rm = TRUE)


# Step 3. Filling for 'Missing' Data 
NLSY_imputed <- NLSY %>% 
  # 3a. YINC 1400 asks whether the individual generated income at all; thus I am making another variable that imputes the continuous variable YINC 1700 with 0 where 1400 is 0.  #Income (Continuous)
  dplyr::mutate(INCOME = ifelse((is.na(`YINC-1700`) & (`YINC-1400` == 0)), 0, `YINC-1700`)) %>%
  # 3b. For number of children in the household, I will fill items with nan in the middle (by person across time); as most nan meant 'does not apply (i.e., no children) I changed this variable to 0.
  dplyr::arrange(PUBID_1997,YEAR) %>% 
  dplyr::group_by(PUBID_1997) %>% 
  #tidyr::fill(PUBID_1997, YEAR,CV_BIO_CHILD_HH,.direction = 'down') %>% 
  dplyr::mutate(N_CHILDREN = ifelse(is.na(CV_BIO_CHILD_HH),0,CV_BIO_CHILD_HH)) %>% 
  ungroup() %>% 
  
  # 3c. For individuals with children, questions about childcare, intergenerational childcare, and spousal childcare appear to be divided between earlier and later cohorts. 
  dplyr::mutate(INTERGENERATION_CHILDCARE =
           ifelse(is.na(`YCCAL-1100A~000002`),`YCCA-1100A~000002`,`YCCAL-1100A~000002`)) %>% 
  dplyr::mutate(SPOUSAL_CHILDCARE =  
           ifelse(is.na(`YCCAL-1100A~000001`),`YCCA-1100A~000001`,`YCCAL-1100A~000001`)) %>% 
  dplyr::mutate(CHILDCARE_CENTER = 
           ifelse(is.na(`YCCAL-1100A~000007`),`YCCA-1100A~000007`,`YCCAL-1100A~000007`)) %>% 
  dplyr::mutate(MARRIED_OR_COHABITATING = 
           ifelse(MAR_STATUS.12_XRND == 2 | MAR_STATUS.12_XRND == 1, 1, 0)) %>% 
  
  # 3d. Recoding variables into binary 
  dplyr::mutate(CV_CITIZENSHIP = 
         ifelse(CV_CITIZENSHIP == 1, 1, ifelse(CV_CITIZENSHIP == 2, 0, NA))) %>% 
  dplyr::group_by(PUBID_1997) %>% 
  dplyr::mutate(CV_CITIZENSHIP = ifelse( !all(is.na(CV_CITIZENSHIP)), max(CV_CITIZENSHIP, na.rm=T), NA)) %>% 
  dplyr::mutate(KEY_BDATE_Y_1997 = max(KEY_BDATE_Y_1997))  


# Step 4. Now I select the relevant columns and filter for individuals with valid data about their education. 
NLSY_Valid <- NLSY_imputed %>% 
  #dplyr::select(PUBID_1997,KEY_BDATE_Y_1997,YEAR,CV_CITIZENSHIP,MARRIED_OR_COHABITATING,INCOME,N_CHILDREN,CV_HH_UNDER_6,INTERGENERATION_CHILDCARE,SPOUSAL_CHILDCARE,CHILDCARE_CENTER,CV_HGC_EVER_EDT) %>% 
  filter(CV_HGC_EVER_EDT != 95) 

print(paste0('Number of Unique Respondents: ', (length(unique(NLSY_Valid$PUBID_1997)))))

# Step 5. For potential later interpretation in this lab I am also going to filter only for individuals with HS level of education and above. 
# NLSY_HS <- NLSY_Valid %>% filter(CV_HGC_EVER_EDT >= 12) 
```

CV_HGC_EVER_EDT
0 = None
1 = GED
2 = High school diploma (Regular 12 YEAR program)
3 = Associate/Junior college (AA)
4 = Bachelor's degree (BA, BS)
5 = Master's degree (MA, MS)
6 = PhD
7 = Professional degree (DDS, JD, MD) 

### Independent and Dependent Variables

#### Dependent Variables 
* INCOME  

#### Independent Variables
* 

#### Control Variables 
* Masters and above  


### Missing Data - Key Variables

Next steps were to look into whether we had missing data when filtering for all necessary filters. 

```{r}
# Valid YEARs for responses about intergenerational childcare 
Valid_Yrs <- list("2005","2008","2011","2015")

# Will Clean Later If Not Used 
# for(i in length(Valid_Yrs)){
#   j=Valid_Yrs[[i]]
# print(
#   NLSY_imputed %>% dplyr::select(PUBID_1997,YEAR,`YCCAL-1100A.01~000002`,CV_BIO_CHILD_HH,CV_HH_UNDER_6) %>% subset(YEAR==j) %>% subset(CV_HH_UNDER_6>0)
#   %>% tidyr::pivot_wider(names_from = YEAR,values_from =`YCCAL-1100A.01~000002`) %>% 
#   vis_miss()
# )
# }


# Will Clean Later If Not Used - Does not appear to show anything of meaning. 
# NLSY_imputed %>% dplyr::select(PUBID_1997,YEAR,`YCCAL-1100A.01~000002`,CV_BIO_CHILD_HH,CV_HH_UNDER_6) %>% subset(YEAR %in% c("2005","2008","2011","2015") ==TRUE) %>% subset(CV_HH_UNDER_6>0) %>% tidyr::pivot_wider(names_from = YEAR,values_from =`YCCAL-1100A.01~000002`) %>% vis_miss()
 
```

First, I looked at the count of valid responses, as well as the count of responses of "Yes" within our dataset over time. For the sake of these analyses, I did filter for years after 2005 (as prior to this, respondents will not have graduated from high school). 

```{r code check}
# Spot Check on Code - Number of rows should equal total in intergenerational_childcare_proportion column. 
# NLSY_imputed %>% dplyr::select(PUBID_1997,YEAR,`YCCA-1100A~000002`,`YCCAL-1100A.01~000002`,`INTERGENERATION_CHILDCARE`,CV_HH_UNDER_6,`INCOME`) %>% subset(YEAR==2005) %>% 
# #%>% subset(YEAR %in% c("2005","2008","2011","2015") ==TRUE) 
#   subset(CV_HH_UNDER_6>0) %>% subset(`INCOME`>0) %>% dplyr::mutate(intergenerational_childcare = ifelse(`INTERGENERATION_CHILDCARE`== 0, 'No',ifelse(`INTERGENERATION_CHILDCARE`== 1,'Yes','NaN'))) %>% dplyr::group_by(YEAR,intergenerational_childcare) %>% dplyr::mutate(intergenerational_childcare_proportion = n()) %>% ungroup() %>% dplyr::group_by(YEAR,intergenerational_childcare, intergenerational_childcare_proportion) %>% subset(INTERGENERATION_CHILDCARE==1)
```

Here, I am filtering for respondents with at least one biological child living in the household as of the survey date.

```{r}
# This is just with everyone with any biological children in the household; it appears here that we don't have a lot of present data.
p1 <- NLSY_Valid %>% dplyr::select(PUBID_1997,YEAR,`INTERGENERATION_CHILDCARE`,CV_BIO_CHILD_HH) %>% subset(YEAR>=2005) %>% subset(CV_BIO_CHILD_HH>0) %>% dplyr::mutate(intergenerational_childcare = ifelse(`INTERGENERATION_CHILDCARE`==0, 'No',ifelse(`INTERGENERATION_CHILDCARE`==1,'Yes','NaN'))) %>% dplyr::group_by(YEAR,intergenerational_childcare) %>% dplyr::mutate(intergenerational_childcare_proportion = n()) %>% ungroup() %>% dplyr::group_by(YEAR,intergenerational_childcare, intergenerational_childcare_proportion) %>% dplyr::summarize() %>% 
  ggplot(aes(x = YEAR, y = intergenerational_childcare_proportion)) +
  geom_bar(stat="identity",aes(fill = intergenerational_childcare)) +
  theme_ipsum(base_size = 12, axis_title_size = 14) +
  scale_fill_manual(values=c("#C9473B", "#75A1AD")) + 
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
        labs(title = '', color = 'Response') +    
    labs(fill = "Primary Child Care Method is Relative Care", 
         y="Count", x = "", title = "Intergenerational Childcare (all women with at least one biological child)")

ggplotly(p1) 
```

The above plot does not fully reflect respondents to this data however, as a precursor to responding to questions about childcare, respondents must have *biological children in the household 6 and under* as well as *income generating work and/or schoolwork*. 

To this point, this plot looks at the non/NA and relative distribution of intergenerational childcare provided for women with children under 6 years of age and with income generating work. 

```{r relative_care}
p2 <- NLSY_Valid %>% dplyr::select(PUBID_1997,YEAR,`YCCA-1100A~000002`,`YCCAL-1100A.01~000002`,`INTERGENERATION_CHILDCARE`,CV_HH_UNDER_6,`INCOME`) %>% subset(YEAR>=2005) %>% 
#%>% subset(YEAR %in% c("2005","2008","2011","2015") ==TRUE) 
  subset(CV_HH_UNDER_6>0) %>% subset(`INCOME`>0) %>% dplyr::mutate(intergenerational_childcare = ifelse(`INTERGENERATION_CHILDCARE`== 0, 'No',ifelse(`INTERGENERATION_CHILDCARE`== 1,'Yes',NA))) %>% dplyr::group_by(YEAR,intergenerational_childcare) %>% dplyr::mutate(intergenerational_childcare_proportion = n()) %>% ungroup() %>% dplyr::group_by(YEAR,intergenerational_childcare, intergenerational_childcare_proportion) %>% dplyr::summarize() %>% 
  ggplot(aes(x = YEAR, y = intergenerational_childcare_proportion)) +
  geom_bar(stat="identity",aes(fill = intergenerational_childcare)) +
  theme_ipsum(base_size = 12, axis_title_size = 14) +
  scale_fill_manual(values=c("#C9473B", "#75A1AD")) + 
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
        labs(title ='' , color = 'Response') +    
    labs(fill = "Primary Child Care Method is Relative Care", 
         y="Count", x = "", title = "Intergenerational Childcare?\n (filtering for individuals\n with income-generating work)")

ggplotly(p2)
```

Meanwhile, this plot shows the distribution of data under YCCA-450, which necessitates non-zero hours (on average) spent by the respondent in 'work,school, or training' in the past year. As this is a specific question asked prior to the questions about childcare, we can see that this has the fewest NA details. 

```{r}
NLSY_Valid %>% dplyr::select(PUBID_1997,YEAR,`INTERGENERATION_CHILDCARE`,CV_HH_UNDER_6,`YCCA-450`,`YCCAL-450`) %>% 
  #subset(YEAR %in% c("2005","2008","2011","2015") ==TRUE) %>% 
  subset(YEAR>=2005) %>% subset(CV_HH_UNDER_6>0) %>% subset(`YCCA-450`!=0 |`YCCAL-450`!=0) %>% dplyr::mutate(intergenerational_childcare = ifelse(`INTERGENERATION_CHILDCARE`==0, 'No',ifelse(`INTERGENERATION_CHILDCARE`==1,'Yes','NaN'))) %>% 
  dplyr::group_by(YEAR,intergenerational_childcare) %>% dplyr::mutate(intergenerational_childcare_proportion = n()) %>% ungroup() %>% dplyr::group_by(YEAR,intergenerational_childcare, intergenerational_childcare_proportion) %>% dplyr::summarize() 
p3 <- NLSY_Valid %>% dplyr::select(PUBID_1997,YEAR,`INTERGENERATION_CHILDCARE`,CV_HH_UNDER_6,`YCCA-450`,`YCCAL-450`) %>% 
  #subset(YEAR %in% c("2005","2008","2011","2015") ==TRUE) %>% 
  subset(YEAR>=2005) %>% subset(CV_HH_UNDER_6>0) %>% subset(`YCCA-450`!=0 |`YCCAL-450`!=0) %>% dplyr::mutate(intergenerational_childcare = ifelse(`INTERGENERATION_CHILDCARE`==0, 'No',ifelse(`INTERGENERATION_CHILDCARE`==1,'Yes','NaN'))) %>% 
  dplyr::group_by(YEAR,intergenerational_childcare) %>% dplyr::mutate(intergenerational_childcare_proportion = n()) %>% ungroup() %>% dplyr::group_by(YEAR,intergenerational_childcare, intergenerational_childcare_proportion) %>% dplyr::summarize() %>% 
  ggplot(aes(x = YEAR, y = intergenerational_childcare_proportion)) +
  geom_bar(stat="identity",aes(fill = intergenerational_childcare)) +
  theme_ipsum(base_size = 12, axis_title_size = 14) +
  scale_fill_manual(values=c("#C9473B", "#75A1AD")) + 
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
        labs(title = '', color = 'Response') +    
    labs(title = "Intergenerational Childcare?\n (filtering for individuals\n in school or work)", 
         y="Count", x = "",fill = "Primary Child Care Method is Relative Care")
ggplotly(p3)
# NLSY %>% dplyr::select(PUBID_1997,YEAR,`YCCAL.1100A.01.000002`) %>% tidyr::pivot_longer(cols = c(PUBID_1997,YEAR,`YCCAL.1100A.01.000002`), names_to = c(PUBID_1997,YEAR,`YCCAL.1100A.01.000002`))
```

These are some summary statistics that I have identified thus far with panel data. As we can see, when I filter for YEARs in which the individual(s) have children and / or valid income data (I imputed some missing values as well) our range is from 1998 - 2017 (nearly 20 years in range). 

Finally, I wanted to look at an alternative independent variable measure - the question about whether a relative is 15 miles away 
```{r}
NLSY_imputed$`YCCA-450`<- as.numeric(NLSY_imputed$`YCCA-450`)
NLSY_imputed$`YCCAL-450`<- as.numeric(NLSY_imputed$`YCCAL-450`)
NLSY_imputed_intergenerational_childcare <- NLSY_imputed %>% subset(!is.na(INTERGENERATION_CHILDCARE))
p4 <- NLSY_imputed_intergenerational_childcare %>% dplyr::select(PUBID_1997,YEAR,`YCCAL-6800`,CV_HH_UNDER_6,CV_BIO_CHILD_HH,INCOME,CV_ENROLLSTAT_EDT,`YCCA-450`,`YCCAL-450`,INTERGENERATION_CHILDCARE) %>% subset(CV_HH_UNDER_6>0 & CV_BIO_CHILD_HH>0) %>% 
  subset(INCOME>0) %>% 
  dplyr::mutate(relative_15 = ifelse(`YCCAL-6800`==1, 'Yes',ifelse(`YCCAL-6800`==0,'No','NaN'))) %>% dplyr::group_by(YEAR,relative_15) %>% dplyr::mutate(relative_15_proportion = n()) %>% ungroup() %>% dplyr::group_by(YEAR,relative_15, relative_15_proportion) %>% dplyr::summarize() %>% 
  ggplot(aes(x = YEAR, y = relative_15_proportion)) +
  geom_bar(stat="identity",aes(fill = relative_15)) +
  theme_ipsum(base_size = 12, axis_title_size = 14) +
  scale_fill_manual(values=c("#C9473B", "#75A1AD")) + 
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
        labs(title = , color = 'Response') +    
    labs(fill = "Relative 15 Miles Away??", y="Count", x = "")

ggplotly(p4)

NLSY_imputed_intergenerational_childcare$YEAR <- as.numeric(NLSY_imputed_intergenerational_childcare$YEAR)
p5 <- NLSY_imputed_intergenerational_childcare %>% dplyr::select(PUBID_1997,YEAR,`YCCAL-6800`,CV_HH_UNDER_6,CV_BIO_CHILD_HH,INCOME,CV_ENROLLSTAT_EDT,`YCCA-450`,`YCCAL-450`,INTERGENERATION_CHILDCARE) %>% subset(CV_HH_UNDER_6>0 & CV_BIO_CHILD_HH>0) %>% 
  subset(INCOME>0) %>% 
  dplyr::mutate(relative_15 = ifelse(`YCCAL-6800`==1, 'Yes',ifelse(`YCCAL-6800`==0,'No','NaN'))) %>% 
  group_by(YEAR) %>% dplyr::mutate(year_count = n()) %>% ungroup() %>% 
  dplyr::group_by(YEAR,relative_15) %>% dplyr::mutate(relative_15_proportion = n()/year_count) %>% ungroup() %>%
  dplyr::group_by(YEAR,relative_15, relative_15_proportion) %>% dplyr::summarize() %>% 
  ggplot(aes(x = YEAR, y = relative_15_proportion)) +
  geom_point()+
  geom_line(stat="identity",aes(linetype = relative_15)) +
  theme_ipsum(base_size = 12, axis_title_size = 14) +
  scale_color_manual(values = c("#273237", "#273237")) +
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank()) +
  #xlim(2005,2008,2011,2018) +
  scale_x_discrete(limits=c(2005,2008,2011,2015)) +
    labs(title = "NLSY Panel Proportions:\nANY RELATIVES LIVE WITHIN 15 MINUTES OF CHILD'S HOME", 
         y="Proportion", x = "",linetype = "")

p5
```

As we can see, this variable has far fewer samples. Our ideal panel size for 5% margin of error and 95% confidence level is 385; thus this variable can only be looked at from a pooled perspective. 


### Descriptive Statistics and Basic Trends

#### Basic Descriptives

The following is a descriptive statistics table of all of the selected variables, used to look at the ranges of questions and validate my understanding about variable filtering and recoding. *note that at this point some variables such as P2-001 are NaN due to spreading characteristics across years; however, we are not currently planning to use those variables for our models, thus will disregard such variables.* 

```{r Basic Descriptives, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE, font.size=6 }
dt <- describe(NLSY_Valid)
dt
```
As shown below, it is clear that there are differences between income trajectories over time for women with children and women without (on average). 

#### Mean Income Over Time
```{r Mean Income Over Time, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
# No filtering for only individuals with valid data around inter-generational childcare 
NSLY_Valid_Summarized <- NLSY_Valid %>% dplyr::mutate(ANY_CHILDREN = ifelse(N_CHILDREN == 0,0,1)) %>% group_by(YEAR,ANY_CHILDREN) %>% dplyr::summarize(mean_income = mean(INCOME,na.rm=TRUE)) %>% mutate(ANY_CHILDREN = ifelse(ANY_CHILDREN==0,'No Children', 'One or More Children'))

NSLY_Valid_Summarized$YEAR <- as.numeric(NSLY_Valid_Summarized$YEAR)

NSLY_Valid_Summarized %>% subset(YEAR>=2005) %>% 
  ggplot(.,aes(x=YEAR, y=mean_income/1000)) +
  geom_point(color = "#273237") + 
  geom_line(color = "#273237",aes(linetype = ANY_CHILDREN)) + 
  theme_ipsum(base_size = 12, axis_title_size = 14) +
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)
      ) +
  scale_x_discrete(limits=c(2005,2010,2015)) +
    labs(title = "NLSY Panel Proportions:\nANY RELATIVES LIVE WITHIN 15 MINUTES OF CHILD'S HOME", 
         y="Mean Annual Income\n($ thousands)", x = "",linetype = "")
```

#### Relative Availability vs Intergenerational Childcare vs Wages 

Try date filters on this graph also 
```{r}
NLSY_imputed_intergenerational_childcare <- NLSY_imputed_intergenerational_childcare %>% subset(!is.na(`YCCAL-6800`))

NLSY_imputed_intergenerational_childcare %>% dplyr::select(PUBID_1997,YEAR,`YCCAL-6800`,CV_HH_UNDER_6,CV_BIO_CHILD_HH,INCOME,CV_ENROLLSTAT_EDT,`YCCA-450`,`YCCAL-450`,INTERGENERATION_CHILDCARE) %>% subset(CV_HH_UNDER_6>0 & CV_BIO_CHILD_HH>0) %>% 
  #subset(`YCCAL-450`!=0) %>% 
  dplyr::mutate(relative_15 = ifelse(`YCCAL-6800`==1, 'Yes',ifelse(`YCCAL-6800`==0,'No','NaN'))) %>% dplyr::group_by(relative_15,INTERGENERATION_CHILDCARE) %>%  dplyr::mutate(intergenerational_childcare = ifelse(`INTERGENERATION_CHILDCARE`==0, 'No',ifelse(`INTERGENERATION_CHILDCARE`==1,'Yes','NaN'))) %>% dplyr::mutate(relative_care_count = n()) %>% ungroup() %>% mutate(perc=100*relative_care_count/nrow(NLSY_imputed_intergenerational_childcare))%>% dplyr::group_by(relative_15, intergenerational_childcare,relative_care_count,perc) %>% dplyr::summarize() %>% 
  ggplot(aes(x = relative_15, y = perc)) +
  geom_bar(stat="identity",aes(fill = intergenerational_childcare),position = "dodge") +
  theme_ipsum(base_size = 12, axis_title_size = 14) +
  scale_fill_manual(values=c("#C9473B", "#75A1AD")) + 
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
        labs(title = , color = 'Response') +    
    labs(fill = "Relative Care?", y="Percent of Data", x = "Relative within 15 Miles")

```
At a first glance it does look like it is more likely that there is relative care in cases where there exists a relative within 15 miles. 


## NLSY79

```{r load data and preprocess 1979, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
# Load Data - Pre-cleaned 
NLSY_79 <- read.csv("~/QMSS/Intergenerational_Childcare_Maternal_Wage_Gap/data/NLSY79/NLSY79_continuous.csv")

colnames(NLSY_79)

describe(NLSY_79)
```


```{r}
# Step 1. Filter for Women Only  
NLSY_79 <- NLSY_79 %>% subset(SAMPLE_SEX == 2)
# Step 2. Filling for 'Missing' Data 

NLSY_79_children <- NLSY_79 %>% subset(NUMCH > 0)
  # 2b. For number of children in the household, I will fill items with nan in the middle (by person across time); as most nan meant 'does not apply (i.e., no children) I changed this variable to 0.

# Step 3. Now I select the relevant columns and filter for individuals with valid data about their education. 

# Step 4. For potential later interpretation in this lab I am also going to filter only for individuals with HS level of education and above. 
```

---
[1]Budig, M. J., & England, P. (2001). The Wage Penalty for Motherhood. American Sociological Review, 66(2), 204–225. https://doi.org/10.2307/2657415